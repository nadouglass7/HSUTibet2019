<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Simple Sidebar - Start Bootstrap Template</title>

  <!-- Bootstrap core CSS -->
  <!-- <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet"> -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <!-- Custom styles for this template -->
  <link href="css/simple-sidebar.css" rel="stylesheet">
    
  <!--    Mapbox Tile API JavaScript and CSS -->
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.1.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.1.0/mapbox-gl.css' rel='stylesheet' />
  <!--    Mapbox Assembly package JavaScript and CSS -->
  <link href='https://api.mapbox.com/mapbox-assembly/v0.20.0/assembly.min.css' rel='stylesheet' />
  <script async defer src="https://api.mapbox.com/mapbox-assembly/v0.10.1/assembly.js"></script>

    
  <style>
      /* Insert the CSS code here between the <style> tags */
      body { margin:0; padding:0; }
      #map { position:fixed; top:0%; bottom:0; left: 0; width:100%; z-index: auto;}
      #loading-background {background-color: grey; opacity:.6; position:absolute; top:0; bottom:0; width:100%; filter: blur(8px);}
      #spinner { position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);}
      
      #menu-toggle {  position: relative; z-index: 1; top: 50%;left: 100%; }
      .toggle-close {right: 100%}
      /*This is modifying the btn-primary colors but you could create your own .btn-something class as well*/
      .btn-primary {
          color: #495057;
          background-color: #f8f9fa;
          border-color: #f8f9fa; /*set the color you want here*/
          border-radius: 0;
          z-index: 1;
      }
      #elevBar {background-color: #f8f9fa; opacity:1; position:absolute; top:85%; bottom:0%; left: 0; width:100%; z-index: 1}

  </style>
  <script>
      window.onload = function () {
          
          var chart = new CanvasJS.Chart("chartContainer", {
              backgroundColor: "#f8f9fa",
              animationEnabled: true,
              title: {
                  text: "Number of iPhones Sold in Different Quarters"
              },
              axisX: {
                  title: "Date",
                  minimum: new Date(2019, 05, 25),
                  maximum: new Date(2019, 02, 15),
                  valueFormatString: "MMM YY"
              },
              axisY: {
                  title: "Number of Sales",
                  titleFontColor: "#4F81BC",
                  suffix: "mn"
              },
              data: [{
                  indexLabelFontColor: "darkSlateGray",
                  name: "views",
                  type: "area",
                  yValueFormatString: "#,##0.0mn",
                  dataPoints: [
                      { x: new Date(2015, 02, 1), y: 74.4, label: "Q1-2015" },
                      { x: new Date(2015, 05, 1), y: 61.1, label: "Q2-2015" },
                      { x: new Date(2015, 08, 1), y: 47.0, label: "Q3-2015" },
                      { x: new Date(2015, 11, 1), y: 48.0, label: "Q4-2015" },
                      { x: new Date(2016, 02, 1), y: 74.8, label: "Q1-2016" },
                      { x: new Date(2016, 05, 1), y: 51.1, label: "Q2-2016" },
                      { x: new Date(2016, 08, 1), y: 40.4, label: "Q3-2016" },
                      { x: new Date(2016, 11, 1), y: 45.5, label: "Q4-2016" },
                      { x: new Date(2017, 02, 1), y: 78.3, label: "Q1-2017", indexLabel: "Highest", markerColor: "red" }
                      { x: new Date(2015, 02, 1), y: 74.4, label: "Q1-2015" },
                      { x: new Date(2015, 05, 1), y: 61.1, label: "Q2-2015" },
                      { x: new Date(2015, 08, 1), y: 47.0, label: "Q3-2015" },
                      { x: new Date(2015, 11, 1), y: 48.0, label: "Q4-2015" },
                      { x: new Date(2016, 02, 1), y: 74.8, label: "Q1-2016" },
                      { x: new Date(2016, 05, 1), y: 51.1, label: "Q2-2016" },
                      { x: new Date(2016, 08, 1), y: 40.4, label: "Q3-2016" },
                      { x: new Date(2016, 11, 1), y: 45.5, label: "Q4-2016" },
                  ]
              }]
          });
          chart.render();
          
      }
  </script>
</head>

<body>

  <div class="d-flex toggled" id="wrapper">
  
    <!-- ####################### -->
             <!-- SIDEBAR -->
    <!-- ####################### -->
    <div class="bg-light border-right" id="sidebar-wrapper">
        <button type="button"  class="btn btn-primary btn-lg" id="menu-toggle" ><h1>&#9776; Menu</h1> </button>
        <h1>HSU Summer Field Study:</h1>
        <hr>
        <h1>2019</h1>
      <div class="list-group list-group-flush">
        <a href="#" class="list-group-item list-group-item-action bg-light">Dashboard</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Shortcuts</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Overview</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Events</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Profile</a>
        <a href="#" class="list-group-item list-group-item-action bg-light">Status</a>
      </div>
    </div>
    <!-- ####################### -->
          <!-- MAIN CONTENT -->
    <!-- ####################### -->
    <div id="page-content-wrapper">  
      <div class="container-fluid">  
        <div id='elevBar' class='elevBar' >
            <div id="chartContainer" style=" background-color: #f8f9fa; height: 100%; width: 100%; position:absolute; top:0; bottom:0; left: 0;"></div>
        </div>
        <div id='map'></div>
  	    <div id="loading-background"></div> 
  	    <div id="spinner" class="loading"></div>
      </div>
    </div>
  </div>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- ####################### -->
  <!-- Menu Toggle Script -->
  <!-- ####################### -->
  <script>
    $("#menu-toggle").click(function(e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });
  </script>

  <!-- ####################### -->    
  <!-- Mapbox Script -->
  <!-- ####################### -->
  <script>   
    
    // mapbox access token
    mapboxgl.accessToken = 'pk.eyJ1IjoibmRjYXJ0b2dyYXBoeSIsImEiOiJjazFneGRhZWsxOTh6M2RtdnBpaWE2dDA1In0.rA-WbVx8DbzgqKvV98puJg';
    // mapbox text labeling plugin
    mapboxgl.setRTLTextPlugin('https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js');

    // ----------------------------------  
    // Initialize map
    // ----------------------------------  
    var map = new mapboxgl.Map({
        container: 'map', // id of a div on your page, where the map will be inserted
        style:'mapbox://styles/ndcartography/ck3gepwhh01vh1cpllgdz3auz', // stylesheet location -- landcover
        center: [103,32.7845177], // starting position [lng, lat] eg. [-122.6788, 45.5212]
    	zoom: 4.8,
    	minZoom: 4.5,
    	maxZoom: 6
    });
    // ----------------------------------
	// loading Spinner variables
    // ----------------------------------
	const spinnerEl = document.getElementById('spinner');
	const backgroundEl = document.getElementById('loading-background');

    // ----------------------------------  
    // Add data sources and initial layers
    // ---------------------------------- 
    map.on("load", function() {
    	// Call initial loadingSpinner function
    	loadingSpinner(false);
    	
    	//-----------------
    	// Add sources:
    	//-----------------
    	
    	// Add source for route data
        map.addSource("route_2019", {
            type: "geojson",
            data: "https://raw.githubusercontent.com/ndcartography/HSUTibet2019/master/data/route_2019_simplified.geojson"
        
        });
    	// Add source for point data
        map.addSource("points_main_2019", {
            type: "geojson",
            data: "https://raw.githubusercontent.com/ndcartography/HSUTibet2019/master/data/points_main_2019.geojson"
        
        });
        
    	//-----------------
    	// Add layers:
    	//-----------------

        // Add the route-2019 as a layer with styles
        map.addLayer({
            id: "route_2019",
            type: "line",
            source: "route_2019",
            paint: {
                "line-width": [
                	"match",
                	["get","class"],
                	"bus", 2,
                	/*other*/ 1
                ],
                "line-color": "#991bc6"
            },
            layout: {
                "line-join": "round",
                "line-cap": "round"
            },
        });

        // Additional train track layer for cool track style
        map.addLayer({
            id: "route_2019_train_tracks",
            type: "line",
            filter: ["==", "class", "train"],
            source: "route_2019",
            paint: {
                "line-color": "#991bc6",
                "line-width": 6,
                "line-dasharray": [.05, 1]
            },
            layout: {
                "line-join": "round",
                "line-cap": "butt"
            },
        });

        // Add map points and styling
        map.addLayer({
            id: "points_main_2019",
            type: "circle",
            source: "points_main_2019",
            paint: {
            	// filter out where attr display is not 1
                "circle-radius": [
                	"match",
                	["get","display"],
                	1, 8,
                	/*other,*/ 0 // if not 1 then make circle size 0
                ],                 	   
                "circle-color": "#991bc6"
            },
            
        });
        // Add map point text and styling
        map.addLayer({
            id: "points_order_2019",
            type: "symbol",
            source: "points_main_2019",
			filter: ["!=", "date_order", " "],
            layout: {
                "text-field": "{date_order}",
                "text-font": ["DIN Offc Pro Bold", "Arial Unicode MS Bold"],
                "text-allow-overlap": true,
                "text-size": [
                	// filter out if display attr is not 1
                	"match",
                	["get", "display"],
        			1, 12,
        			/*other,*/ 0 // if display not 1 then text will not appear
        		],
            },
            paint: {
    			"text-color": "white"
  			}
        }); 
        
        //-----------------------------------------
        // Add labels for city/place name stops
        //-----------------------------------------
        map.addLayer({
            "id": "points_name_2019",
            "type": "symbol",
            "source": "points_main_2019",
            "layout": {
                "text-field": ["get", "Name"],
                "text-variable-anchor": ["bottom-left", "top-right"],
                "text-radial-offset": 0.5,
                "text-justify": "auto",
                "text-size": [
                	// filter out if display attr is not 1
                	"match",
                	["get", "display"],
        			1, 16,
        			/*other,*/ 0 // if display not 1 then text will not appear
        		],
            },
            paint: {
                "text-color": "black",
                "text-halo-color": "#fff",
            	"text-halo-width": 1.7
            },
        });
        
        //----------------------------------------------------------
        // add spinner, initialize spinner stop when layers render
        //----------------------------------------------------------
        setTimeout(
        function addLayerSpinner(){
        	// Call initial loadingSpinner function true
        	loadingSpinner(true);
        	// Stop spinner when layers render
        	map.on('render', stopSpinner);
        },0)
    });
    
    // -------------------------------
    // loading spinner Functions
    // -------------------------------

	// stop spinner function
    function stopSpinner (e) {
        if (e.target && e.target.loaded()) {
            loadingSpinner(false);
            map.off('render', stopSpinner)
        }
    }
    
    // load spinner function - when new layer clicked
    function loadingSpinner(on) {
        if (on) {
            spinnerEl.classList.add('loading');
            backgroundEl.classList.add('absolute');
            backgroundEl.classList.remove('none');
        } else {
            spinnerEl.classList.remove('loading');
            backgroundEl.classList.remove('absolute');
            backgroundEl.classList.add('none');
        }
    }      
      
      

  </script>
  <script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</body>

</html>
