<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>HSU Tibet 2019</title>

  <!-- Bootstrap core CSS -->
  <!-- <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet"> -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <!-- CSS link for main.css -->
  <link href="css/main.css" rel="stylesheet">
    
  <!-- CSS for side slide-bar -->
  <link href="css/simple-sidebar.css" rel="stylesheet">
    
  <!--    Mapbox Tile API JavaScript and CSS -->
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.1.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.1.0/mapbox-gl.css' rel='stylesheet' />
  <!--    Mapbox Assembly package JavaScript and CSS -->
  <link href='https://api.mapbox.com/mapbox-assembly/v0.20.0/assembly.min.css' rel='stylesheet' />
  <script async defer src="https://api.mapbox.com/mapbox-assembly/v0.10.1/assembly.js"></script>

  <!--    Canvas.js chart script -->
  <script src='js/elevChart.js'></script>
  
  <style>
    .btn-primary {
        color: #495057;
        background-color: #f8f9fa;
        border-color: #f8f9fa; /*set the color you want here*/
        border-radius: 0;
        z-index: 1;
        position:absolute;
        top:0;
        left: 0;
    }
  </style>
  
</head>

<body>

  <div class="d-flex toggled" id="wrapper">
  
    <!-- ####################### -->
             <!-- SIDEBAR -->
    <!-- ####################### -->
    <div class="bg-light border-right" id="sidebar-wrapper">
      <button type="button"  class="btn btn-primary btn-lg" id="menu-toggle" ><h1>&#9776; Menu</h1> </button>

      <a  class="list-group"></a>
      <h3 class="card-title"><b>HSU China Tibet Field Study:</b></h3>
      <h3 class="card-title"><b>Summer 2019</b></h3>
      <div class="list-group list-group-flush">
        <div class="card-body">
          <h3 class="card-title"><b>Summary:</b></h3>
          <p class="card-text">This map shows the field study route taken during the summer 2019. Numbers indicate places visited in order </p>
        </div>
        
        <div class="card-body">
          <h5 class="card-title"><b>Dates</b></h5>
          <p class="card-text">May 28th - July 6th</p>
        </div>
        
        <div class="card-body">
          <h5 class="card-title"><b>Duration:</b></h5>
          <p class="card-text"> 5 Weeks, 4 Days </p>
        </div>
        
        <div class="card-body">
          <h5 class="card-title"><b>Approx. Driving Distance:</b></h5>
          <p class="card-text"> 3,495 mi</p>
        </div>
        
        <div class="card-body">
          <h5 class="card-title"><b>Number of Students:</b></h5>
          <p class="card-text"> 13 </p>
        </div>

      </div>
    </div>
    <!-- ####################### -->
          <!-- MAIN CONTENT -->
    <!-- ####################### -->
    <div id="page-content-wrapper">  
      <div class="container-fluid">  
        
        <!-- Elevation Chart -->
        <div id='elevBar' class='elevBar' >
            <div id="chartContainer" style=" background-color: #f8f9fa; height: 100%; width: 100%; position:absolute; top:0; bottom:0; left: 0;"></div>
        </div>
          
        <!-- Splash Screen Title -->
        <div id='titleBar' class='titleBar' > 
            <button id="x-box" type="button" class="close" aria-label="Close" onclick="closeTitle()">
                <span aria-hidden="true" id="x">&times;</span>
            </button>
            <div class="container">
                <div id="header">
                    <i>Humboldt State China & Tibet Field Study 2019</i>
                </div>
                <hr>
                <div id="subtext">
                    <p>
                        The Tibetan Plateau has long been regarded as one of the most isolated regions on Earth. Due to globalization and recent influxes of tourism, this once untouched landscape has now been subject to significant physical and cultural change. With the help of Humboldt State professor Toni Rossi, students have been able to visit this area through the Humboldt State Tibet & China Field Study Program. In the summer of 2019, the program took its final trip, making this the 14th and final year that students have been able to conduct meaningful field research, in a rapidly changing landscape. This map details the route taken and helps illustrate the extraordinary journey. 
                    </p>
                </div>
                <div id="subtext">
                    <i>
                       "Quote" 
                    </i>
                </div>
            </div>  
        </div>
        <!-- Map -->
        <div id='map'></div>
          
        <!-- Loading Spinner and Background -->
  	    <div id="loading-background"></div> 
  	    <div id="spinner" class="loading"></div>
      </div>
    </div>
  </div>
  <!-- ####################### -->
  <!-- Bootstrap core JavaScript -->
  <!-- ####################### -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- ####################### -->
  <!-- Menu Toggle Script -->
  <!-- ####################### -->
  <script>
    $("#menu-toggle").click(function(e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });
    
    function closeTitle() {
      var x = document.getElementById("titleBar");
      if (x.style.display === "none") {
        x.style.display = "block";
      } else {
        x.style.display = "none";
      }
    }
  </script>

  <!-- ####################### -->    
  <!-- Mapbox Script -->
  <!-- ####################### -->
  <script>   
    
    // mapbox access token
    mapboxgl.accessToken = 'pk.eyJ1IjoibmRjYXJ0b2dyYXBoeSIsImEiOiJjazFneGRhZWsxOTh6M2RtdnBpaWE2dDA1In0.rA-WbVx8DbzgqKvV98puJg';
    // mapbox text labeling plugin
    mapboxgl.setRTLTextPlugin('https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js');

    // ----------------------------------  
    // Initialize map
    // ----------------------------------  
    var map = new mapboxgl.Map({
        container: 'map', // id of a div on your page, where the map will be inserted
        style:'mapbox://styles/ndcartography/ck3gepwhh01vh1cpllgdz3auz', // stylesheet location -- landcover
        center: [103,32.7845177], // starting position [lng, lat] eg. [-122.6788, 45.5212]
    	zoom: 4.5,
    	minZoom: 4.5,
    	maxZoom: 6
    });
    // ----------------------------------
	// loading Spinner variables
    // ----------------------------------
	const spinnerEl = document.getElementById('spinner');
	const backgroundEl = document.getElementById('loading-background');

    // ----------------------------------  
    // Add data sources and initial layers
    // ---------------------------------- 
    map.on("load", function() {
    	// Call initial loadingSpinner function
    	loadingSpinner(false);
    	
    	//-----------------
    	// Add sources:
    	//-----------------
    	
    	// Add source for route data
        map.addSource("route_2019", {
            type: "geojson",
            data: "https://raw.githubusercontent.com/ndcartography/HSUTibet2019/master/data/route_2019_simplified.geojson"
        
        });
    	// Add source for point data
        map.addSource("points_main_2019", {
            type: "geojson",
            data: "https://raw.githubusercontent.com/ndcartography/HSUTibet2019/master/data/points_main_2019.geojson"
        
        });
        
    	//-----------------
    	// Add layers:
    	//-----------------

        // Add the route-2019 as a layer with styles
        map.addLayer({
            id: "route_2019",
            type: "line",
            source: "route_2019",
            paint: {
                "line-width": [
                	"match",
                	["get","class"],
                	"bus", 2,
                	/*other*/ 1
                ],
                "line-color": "#991bc6"
            },
            layout: {
                "line-join": "round",
                "line-cap": "round"
            },
        });

        // Additional train track layer for cool track style
        map.addLayer({
            id: "route_2019_train_tracks",
            type: "line",
            filter: ["==", "class", "train"],
            source: "route_2019",
            paint: {
                "line-color": "#991bc6",
                "line-width": 6,
                "line-dasharray": [.05, 1]
            },
            layout: {
                "line-join": "round",
                "line-cap": "butt"
            },
        });

        // Add map points and styling
        map.addLayer({
            id: "points_main_2019",
            type: "circle",
            source: "points_main_2019",
            paint: {
            	// filter out where attr display is not 1
                "circle-radius": [
                	"match",
                	["get","display"],
                	1, 8,
                	/*other,*/ 0 // if not 1 then make circle size 0
                ],                 	   
                "circle-color": "#991bc6"
            },
            
        });
        // Add map point text and styling
        map.addLayer({
            id: "points_order_2019",
            type: "symbol",
            source: "points_main_2019",
			filter: ["!=", "date_order", " "],
            layout: {
                "text-field": "{date_order}",
                "text-font": ["DIN Offc Pro Bold", "Arial Unicode MS Bold"],
                "text-allow-overlap": true,
                "text-size": [
                	// filter out if display attr is not 1
                	"match",
                	["get", "display"],
        			1, 12,
        			/*other,*/ 0 // if display not 1 then text will not appear
        		],
            },
            paint: {
    			"text-color": "white"
  			}
        }); 
        
        //-----------------------------------------
        // Add labels for city/place name stops
        //-----------------------------------------
        map.addLayer({
            "id": "points_name_2019",
            "type": "symbol",
            "source": "points_main_2019",
            "layout": {
                "text-field": ["get", "Name"],
                "text-variable-anchor": ["bottom-left", "top-right"],
                "text-radial-offset": 0.5,
                "text-justify": "auto",
                "text-size": [
                	// filter out if display attr is not 1
                	"match",
                	["get", "display"],
        			1, 16,
        			/*other,*/ 0 // if display not 1 then text will not appear
        		],
            },
            paint: {
                "text-color": "black",
                "text-halo-color": "#fff",
            	"text-halo-width": 1.7
            },
        });
        
        //----------------------------------------------------------
        // add spinner, initialize spinner stop when layers render
        //----------------------------------------------------------
        setTimeout(
        function addLayerSpinner(){
        	// Call initial loadingSpinner function true
        	loadingSpinner(true);
        	// Stop spinner when layers render
        	map.on('render', stopSpinner);
        },0)
    });
    
    // -------------------------------
    // loading spinner Functions
    // -------------------------------

	// stop spinner function
    function stopSpinner (e) {
        if (e.target && e.target.loaded()) {
            loadingSpinner(false);
            map.off('render', stopSpinner)
        }
    }
    
    // load spinner function - when new layer clicked
    function loadingSpinner(on) {
        if (on) {
            spinnerEl.classList.add('loading');
            backgroundEl.classList.add('absolute');
            backgroundEl.classList.remove('none');
        } else {
            spinnerEl.classList.remove('loading');
            backgroundEl.classList.remove('absolute');
            backgroundEl.classList.add('none');
        }
    }      
      

  </script>
  <script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</body>

</html>
